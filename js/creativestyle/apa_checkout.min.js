if(!window.Review)var Review=function(){};var APA={submitAllowed:!1,paymentSelected:!1,reloaded:!1,Widgets:{ShippingMethod:Class.create({initialize:function(e){this.layer=$(APA.layers.shippingMethod),Object.extend(this,e),Event.stopObserving(this.layer,"widget:update").observe("widget:update",this.onUpdate.bindAsEventListener(this))},update:function(e){try{if(Element.update(this.layer,e),!this.layer.down("input[type=radio]:checked")){var t=this.layer.down("input[type=radio]");t&&(t.checked=!0)}Event.stopObserving(this.layer,"change").observe("change",this.onShippingMethodSelect.bindAsEventListener(this)),Event.stopObserving(this.layer,"widget:checked").observe("widget:checked",this.onShippingMethodSelect.bindAsEventListener(this)),Event.fire(this.layer,"widget:update")}catch(r){this.onError(r)}}}),Review:Class.create({initialize:function(e){this.layer=$(APA.layers.review),Object.extend(this,e)},update:function(e){try{Element.update(this.layer,e)}catch(t){this.onError(t)}}})},setLoadWaiting:function(){for(var e=0;e<arguments.length;e++)if($(arguments[e])){var t=$(arguments[e]).up("li");t.addClassName("loading")}return this},unsetLoadWaiting:function(){for(var e=0;e<arguments.length;e++)if($(arguments[e])){var t=$(arguments[e]).up("li");t.removeClassName("loading")}return this},setOrderSaveWaiting:function(){if($(APA.layers.review)){var e=$(APA.layers.review).down(".please-wait");e&&Element.show(e)}return this.showOverlay(),this.disableSubmit(),this},unsetOrderSaveWaiting:function(){if($(APA.layers.review)){var e=$(APA.layers.review).down(".please-wait");e&&Element.hide(e)}return this.hideOverlay(),this},showOverlay:function(){return $("checkoutSteps")&&$("checkoutSteps").insert({top:new Element("div",{"class":"amazon-widget-overlay"})}),this},hideOverlay:function(){return $("checkoutSteps")&&$("checkoutSteps").down(".amazon-widget-overlay")&&$("checkoutSteps").down(".amazon-widget-overlay").remove(),this.toggleSubmit(),this},initCheckout:function(){return this.disableSubmit().scaffoldPaymentWidget(),this.virtual?this.setLoadWaiting(APA.layers.wallet).renderWalletWidget().allowSubmit(!0):this.orderReferenceId?this.setLoadWaiting(APA.layers.shippingMethod,APA.layers.wallet,APA.layers.review).renderAddressBookWidget().renderWalletWidget():this.setLoadWaiting(APA.layers.shippingMethod,APA.layers.wallet,APA.layers.review).renderAddressBookWidget()},scaffoldPaymentWidget:function(){return"undefined"==typeof APA.design.wallet.size||APA.design.responsive||(APA.design.wallet.size.width&&$(APA.layers.wallet).up().setStyle({width:APA.design.wallet.size.width}),APA.design.wallet.size.height&&$(APA.layers.wallet).up().setStyle({height:APA.design.wallet.size.height})),this},renderButtonWidget:function(e){if(null!==APA.urls.login?($$(APA.layers.payButtons).each(function(e){var t={type:e.buttonType||APA.design.payButton.type||"PwA",size:e.buttonSize||APA.design.payButton.size,color:e.buttonColor||APA.design.payButton.color,authorization:function(){amazon.Login.authorize({scope:"profile payments:widget payments:shipping_address payments:billing_address",popup:APA.popup},APA.urls.pay)},onError:APA.buttonErrorCallback};APA.language&&(t.language=APA.language),new OffAmazonPayments.Button(e.identify(),APA.sellerId,t)}),$$(APA.layers.loginButtons).each(function(e){var t={type:e.buttonType||APA.design.loginButton.type||"LwA",size:e.buttonSize||APA.design.loginButton.size,color:e.buttonColor||APA.design.loginButton.color,authorization:function(){amazon.Login.authorize({scope:"profile payments:widget payments:shipping_address payments:billing_address",popup:APA.popup},APA.urls.login)},onError:APA.buttonErrorCallback};APA.language&&(t.language=APA.language),new OffAmazonPayments.Button(e.identify(),APA.sellerId,t)})):$$(APA.layers.payButtons).each(function(e){new OffAmazonPayments.Widgets.Button({sellerId:APA.sellerId,useAmazonAddressBook:!APA.virtual,onSignIn:APA.signInCallback,onError:APA.buttonErrorCallback}).bind(e.identify())}),e&&"undefined"!=typeof Tooltip&&!APA.isMobileDevice()){var t=$$(APA.layers.payButtons+","+APA.layers.loginButtons).findAll(function(e){return e.hasClassName("with-tooltip")});if(t.length){var r=document.createElement("div");r.setAttribute("id","pay-with-amazon-tooltip"),r.addClassName("pay-with-amazon-tooltip"),r.setStyle({display:"none",zIndex:10}),r.update(e),document.body.appendChild(r),t.each(function(e){var t=e.down("img");t&&new Tooltip(t,r)})}}},signInCallback:function(e){var t=document.createElement("input");t.setAttribute("type","hidden"),t.setAttribute("name","orderReferenceId"),t.setAttribute("value",e.getAmazonOrderReferenceId());var r=document.createElement("form");r.setAttribute("method","post"),r.setAttribute("action",APA.urls.checkout),r.appendChild(t),document.body.appendChild(r),r.submit()},renderAddressBookWidget:function(){return APA.setLoadWaiting(APA.layers.shippingMethod,APA.layers.review),new OffAmazonPayments.Widgets.AddressBook({sellerId:APA.sellerId,onOrderReferenceCreate:APA.orderReferenceCreateCallback,amazonOrderReferenceId:APA.orderReferenceId,design:APA.design.responsive?{designMode:"responsive"}:APA.design.addressBook,onAddressSelect:APA.addressSelectCallback,onError:APA.amazonErrorCallback}).bind(APA.layers.addressBook),this},renderReadOnlyAddressBookWidget:function(){return new OffAmazonPayments.Widgets.AddressBook({sellerId:APA.sellerId,amazonOrderReferenceId:APA.orderReferenceId,design:APA.design.responsive?{designMode:"responsive"}:APA.design.addressBook,onError:APA.amazonErrorCallback,displayMode:"Read"}).bind(APA.layers.addressBook),this},orderReferenceCreateCallback:function(e){APA.orderReferenceId||(APA.orderReferenceId=e.getAmazonOrderReferenceId(),APA.virtual||APA.renderWalletWidget())},addressSelectCallback:function(){APA.selectPayment(!1),APA.setLoadWaiting(APA.layers.shippingMethod,APA.layers.review),new Ajax.Request(APA.urls.saveShipping,{method:"post",parameters:{orderReferenceId:APA.orderReferenceId},evalScripts:!0,onSuccess:APA.successCallback,onFailure:APA.ajaxFailureCallback})},renderShippingMethodWidget:function(e){return APA.setLoadWaiting(APA.layers.review),new APA.Widgets.ShippingMethod({onShippingMethodSelect:APA.shippingMethodSelectCallback,onUpdate:APA.shippingMethodUpdateCallback,onError:APA.magentoErrorCallback}).update(e),this},shippingMethodSelectCallback:function(e){APA.setLoadWaiting(APA.layers.review),new Ajax.Request(APA.urls.saveShippingMethod,{method:"post",parameters:Form.serialize($("co-shipping-method-form")),evalScripts:!0,onSuccess:APA.successCallback,onFailure:APA.ajaxFailureCallback})},shippingMethodUpdateCallback:function(e){var t=Event.element(e);Event.fire(t,"widget:checked")},renderWalletWidget:function(){return new OffAmazonPayments.Widgets.Wallet({sellerId:APA.sellerId,onOrderReferenceCreate:APA.orderReferenceCreateCallback,amazonOrderReferenceId:APA.orderReferenceId,design:APA.design.responsive?{designMode:"responsive"}:APA.design.wallet,onPaymentSelect:APA.paymentSelectCallback,onError:APA.amazonErrorCallback}).bind(APA.layers.wallet),this},paymentSelectCallback:function(){APA.selectPayment(!0)},reloadWallet:function(){return this.renderReadOnlyAddressBookWidget().renderWalletWidget(),this},renderReviewWidget:function(e){return new APA.Widgets.Review({onError:APA.magentoErrorCallback}).update(e),this.toggleSubmit(),this},successCallback:function(transport){response=eval("("+transport.responseText+")"),response.error&&APA.magentoErrorCallback(response.error_messages),response.render_widget&&$H(response.render_widget).each(function(e){APA["render"+e.key.capitalize().camelize()+"Widget"](e.value),e.value&&APA.unsetLoadWaiting(APA.layers[e.key.camelize()])}),response.allow_submit?APA.allowSubmit(!0):APA.allowSubmit(!1)},saveOrderCallback:function(transport){response=eval("("+transport.responseText+")"),response.success&&(window.location=APA.urls.success),response.logout&&"undefined"!=typeof amazon&&amazon.Login.logout(),response.error&&(APA.unsetOrderSaveWaiting(),APA.magentoErrorCallback(response.error_messages),response.reload&&(APA.reloaded=!1,APA.orderReferenceId=null,APA.initCheckout()),response.reload_wallet&&(APA.reloaded=!0,APA.disableSubmit().reloadWallet())),response.redirect&&(window.location=response.redirect)},ajaxFailureCallback:function(){window.location.href=APA.urls.failure},confirmErrorRedirect:function(e,t){return confirm("An error occured. Redirect to failure URL?\n\nERROR DETAILS:\n==============\n["+e.getErrorCode()+"]: "+e.getErrorMessage()+"\n\nDEBUG DATA:\n==============\nREDIRECT URL = "+t+(APA.sellerId?"\nMERCHANT ID = "+APA.sellerId:"")+(APA.orderReferenceId?"\nORDER REFERENCE ID = "+APA.orderReferenceId:"")+(APA.language?"\nLANGUAGE = "+APA.language:"")+"\nPOPUP EXPERIENCE = "+(APA.popup?"yes":"no")+"\nVIRTUAL ORDER = "+(APA.virtual?"yes":"no")+"\n\nSTACK TRACE:\n==============\n"+(new Error).stack)},buttonErrorCallback:function(e){APA.live||(console.error("BUTTON ERROR ["+e.getErrorCode()+"]: "+e.getErrorMessage()),console.trace())},amazonErrorCallback:function(e){var t=({"Order Reference ID":APA.orderReferenceId},["InvalidOrderReferenceId"]);if(t.any(function(t){return t==e.getErrorCode()}))return void((APA.live||APA.confirmErrorRedirect(e,APA.urls.clear||APA.urls.failure))&&(window.location.href=APA.urls.clear||APA.urls.failure));var r=["AddressNotModifiable","PaymentMethodNotModifiable"];if(r.any(function(t){return t==e.getErrorCode()}))return void((APA.live||APA.confirmErrorRedirect(e,APA.urls["void"]||APA.urls.failure))&&(window.location.href=APA.urls["void"]||APA.urls.failure));var n=["BuyerNotAssociated","BuyerSessionExpired","StaleOrderReference"];return n.any(function(t){return t==e.getErrorCode()})?void((APA.live||APA.confirmErrorRedirect(e,APA.urls.failure))&&(window.location.href=APA.urls.failure)):void(APA.live||(console.error("AMAZON ERROR ["+e.getErrorCode()+"]: "+e.getErrorMessage()),console.trace()))},magentoErrorCallback:function(e){APA.live||console.trace(),"object"==typeof e&&(e=e.join("\n")),e&&alert(e)},allowSubmit:function(e){return this.submitAllowed=e,this.toggleSubmit()},selectPayment:function(e){return this.paymentSelected=e,this.toggleSubmit()},toggleSubmit:function(){return this.submitAllowed&&this.paymentSelected?this.enableSubmit():this.disableSubmit()},disableSubmit:function(){var e=$("amazonpayments-checkout-place-order-button");if(e){e.disabled=!0;var t=e.up("div.buttons-set");t&&t.addClassName("disabled")}return this},enableSubmit:function(){if(this.submitAllowed&&this.paymentSelected){var e=$("amazonpayments-checkout-place-order-button");if(e){e.disabled=!1;var t=e.up("div.buttons-set");t&&t.removeClassName("disabled")}}return this},saveOrder:function(){APA.setOrderSaveWaiting(),new Ajax.Request(APA.urls.saveOrder,{method:"post",parameters:APA.getSaveOrderParams(),onSuccess:APA.saveOrderCallback,onFailure:APA.ajaxFailureCallback})},getSaveOrderParams:function(){var e="";return APA.virtual?(e+=Object.toQueryString({orderReferenceId:APA.orderReferenceId}),$("checkout-agreements")&&(e+="&"+Form.serialize($("checkout-agreements")))):(e=Form.serialize($("co-shipping-method-form")),$("checkout-agreements")&&(e+="&"+Form.serialize($("checkout-agreements")))),APA.reloaded&&(e+="&"+Object.toQueryString({reloaded:1})),e.save=!0,e},isMobileDevice:function(){return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(navigator.userAgent||navigator.vendor||window.opera)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test((navigator.userAgent||navigator.vendor||window.opera).substr(0,4))},initialize:function(e,t,r,n,i,o,a){return Object.extend(APA,{sellerId:e,orderReferenceId:t,live:r,virtual:n,urls:Object.extend({login:null,pay:null,checkout:null,saveShipping:null,saveShippingMethod:null,saveOrder:null,success:null,failure:null},i),layers:Object.extend({payButtons:".payButtonWidget",loginButtons:".loginButtonWidget",addressBook:"addressBookWidgetDiv",wallet:"walletWidgetDiv",shippingMethod:"shippingMethodWidgetDiv",review:"reviewWidgetDiv"},o),design:Object.extend({addressBook:{size:{width:"440px",height:"260px"}},wallet:{size:{width:"440px",height:"260px"}},payButton:{type:"PwA"},loginButton:{type:"LwA"}},a)})},setup:function(e,t){return Object.extend(APA,{sellerId:e,orderReferenceId:"undefined"==typeof t.orderReferenceId?null:t.orderReferenceId,language:"undefined"==typeof t.language?null:t.language,live:"undefined"==typeof t.live?!0:t.live,popup:"undefined"==typeof t.popup?!0:t.popup,virtual:"undefined"==typeof t.virtual?!1:t.virtual,layers:Object.extend({payButtons:".payButtonWidget",loginButtons:".loginButtonWidget",addressBook:"addressBookWidgetDiv",wallet:"walletWidgetDiv",shippingMethod:"shippingMethodWidgetDiv",review:"reviewWidgetDiv"},t.layers),urls:Object.extend({login:null,pay:null,checkout:null,saveShipping:null,saveShippingMethod:null,saveOrder:null,clear:null,"void":null,success:null,failure:null},t.urls),design:Object.extend({responsive:!0,addressBook:{size:{width:"440px",height:"260px"}},wallet:{size:{width:"440px",height:"260px"}},payButton:{type:"PwA"},loginButton:{type:"LwA"}},t.design)})}};