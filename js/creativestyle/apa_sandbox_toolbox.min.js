if("undefined"==typeof APA)var APA={};APA.Toolbox={clearSimulationObjects:function(){APA.Toolbox.objectSelect.descendants().each(Element.remove),APA.Toolbox.objectSelect.hide().disable().insert(new Element("option",{value:""}).update(APA.Toolbox.labels.object))},clearSimulationStates:function(){APA.Toolbox.stateSelect.descendants().each(Element.remove),APA.Toolbox.stateSelect.hide().disable().insert(new Element("option",{value:""}).update(APA.Toolbox.labels.state))},clearSimulationReasons:function(){APA.Toolbox.reasonSelect.descendants().each(Element.remove),APA.Toolbox.reasonSelect.hide().disable().insert(new Element("option",{value:""}).update(APA.Toolbox.labels.reason))},fillSimulationObjects:function(){APA.Toolbox.clearSimulationReasons(),APA.Toolbox.clearSimulationStates(),APA.Toolbox.clearSimulationObjects(),$H(APA.Toolbox.availableSimulations).each(function(e){APA.Toolbox.objectSelect.insert(new Element("option",{value:e.key}).update(e.key))}),APA.Toolbox.objectSelect.enable().show(),APA.Toolbox.objectSelect.observe("change",function(e){var o=APA.Toolbox.objectSelect.getValue();o&&"undefined"!=typeof APA.Toolbox.availableSimulations[o]&&"undefined"!=typeof APA.Toolbox.availableSimulations[o].states?APA.Toolbox.fillSimulationStates(APA.Toolbox.availableSimulations[o].states):(APA.Toolbox.clearSimulationReasons(),APA.Toolbox.clearSimulationStates())})},fillSimulationStates:function(e){APA.Toolbox.clearSimulationReasons(),APA.Toolbox.clearSimulationStates(),$H(e).each(function(e){APA.Toolbox.stateSelect.insert(new Element("option",{value:e.key}).update(e.key))}),APA.Toolbox.stateSelect.enable().show(),APA.Toolbox.stateSelect.observe("change",function(o){var t=APA.Toolbox.stateSelect.getValue();t&&"undefined"!=typeof e[t]&&"undefined"!=typeof e[t].reasons?APA.Toolbox.fillSimulationReasons(e[t].reasons):APA.Toolbox.clearSimulationReasons()})},fillSimulationReasons:function(e){APA.Toolbox.clearSimulationReasons(),$H(e).each(function(e){APA.Toolbox.reasonSelect.insert(new Element("option",{value:e.key}).update(e.key))}),APA.Toolbox.reasonSelect.enable().show()},initialize:function(e,o,t){document.observe("dom:loaded",Object.extend(APA.Toolbox,{availableSimulations:e,objectSelect:$(o.object),stateSelect:$(o.state),reasonSelect:$(o.reason),labels:t}).fillSimulationObjects)}},APA.getSaveOrderParams=function(){var e="";return APA.virtual?(e+=Object.toQueryString({orderReferenceId:APA.orderReferenceId}),$("checkout-agreements")&&(e+="&"+Form.serialize($("checkout-agreements")))):(e=Form.serialize($("co-shipping-method-form")),$("checkout-agreements")&&(e+="&"+Form.serialize($("checkout-agreements")))),APA.reloaded&&(e+="&"+Object.toQueryString({reloaded:1})),$("sandbox-simulation")&&$("simulation_object").getValue()&&(e+="&"+Form.serialize($("sandbox-simulation"))),e.save=!0,e};